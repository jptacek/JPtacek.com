<!DOCTYPE html>
<html>
<head>
    <!-- Meta -->
    <meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <meta name="description" content="Mobile, Web and JavaScript" />

<title>Have Your Pi and Eat it Too: A Comparison of C# and C++ Performance - JPtacek.com | Musings on code and who knows what 3ls3</title>
    <meta name="generator" content="DocPad v6.78.4" />
    

    <meta name="author" content="John Ptacek">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/styles/chemistry.css" rel="stylesheet" />
    <link href="/styles/site.css" rel="stylesheet" />
    <link href="/css/highlight.css" rel="stylesheet" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

</head>
<body>

<a href="https://plus.google.com/+JohnPtacek?rel=author" class="google googleplus-hidden" title="Google+">Google+</a>



<div class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">John Ptacek</a> <div class="navbar-brand"> - Musings on Code</div>
        </div>
        <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <!--<li><a href="/">Blog</a></li>-->
                
                    <li><a href="/archives/">Archives</a></li>
                
                    <li><a href="/about/">About</a></li>
                
                <li class="hidden-xs">
                    <a href="/feed/index.xml" class="rss"><i class="fa fa-rss fa-lg"></i></a>
                    <a href="https://twitter.com/jptacek" class="twitter"><i class="fa fa-twitter fa-lg"></i></a>
                    <a href="https://plus.google.com/+johnptacek" class="googleplus"><i class="fa fa-google-plus fa-lg"></i></a>
                    <a href="https://linkedin.com/in/johnptacek" class="linkedin"><i class="fa fa-linkedin fa-lg"></i></a>
                    <a href="https://stackoverflow.com/users/39797/john-ptacek" class="stackoverflow"><i class="fa fa-stack-overflow fa-lg"></i></a>
                    <a href="https://github.com/jptacek" class="github"><i class="fa fa-github fa-lg"></i></a>
                </li>
            </ul>
            <form class="navbar-form navbar-right hidden-xs" role="search" action="https://google.com/search"
                  method="get">
                <div class="form-group">
                    <input type="search" name="q" class="form-control" placeholder="Search">
                    <input type="hidden" name="q" value="site:jptacek.com">
                </div>
            </form>
        </div>
    </div>
</div>

<div class="container">
            <article class="post">
    
    <h1>Have Your Pi and Eat it Too: A Comparison of C# and C++ Performance</h1>
    
        <div class="post-date">Mar 14th, 2013</div>

    <div class="post-content">
        <p>In honor of <a href="http://en.wikipedia.org/wiki/Pi_Day">National Pi Day</a>, we thought it would be fun to calculate Pi and talk about performance differences between C# and C++. There is some math coming your way (yeah Math!), but feel free to skip to the end for a discussion on performance.</p>
<p>So back in the day, when things where WAY different, Pi was calculated using a mathematical series. One of the more famous ones uses the arctan math function to calculate the value of π. This is called the Leibniz formula for π and is represented by</p>
<p><img src="/2013/03/have_your_pi/pi1.jpg" alt="Pictue 1"></p>
<p>Now, this is one of the more inefficient ways to calculate π, it takes about 10 million terms to get an accuracy of 7 decimal places. For those of us asking performance differences between languages though, that is great! </p>
<p>We have written two programs to calculate π, one in C# and one in C++. They are both syntactically similar and use the same algorithm. We tried to get as close to an apples comparison as we could, but in comparing two different languages, we did our best, you are still comparing an apple to an orange.</p>
<p>So, what did we see? We calculated π to 15 decimal points, 3.141592653589793 for those of you keeping track at home. Both programs took almost 100 million iterations to converge, 99,995,330 to be exact. We ran each of the programs 10 times to get an average as shown in the following table</p>
<div style="text-align: center"><table style="border-collapse:collapse" border="0"><colgroup><col style="width:102px"><col style="width:102px"><col style="width:66px"></colgroup><tbody valign="top"><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  solid 0.5pt; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt"><strong>Run</strong></span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  solid 0.5pt; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt"><strong>C++</strong></span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  solid 0.5pt; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt"><strong>C#</strong></span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">1</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.384</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.908</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">2</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.299</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.466</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">3</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.3375</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.805</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.18</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.584</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">5</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.523</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.516</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.186</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.518</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">7</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.164</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.492</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">8</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.175</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.351</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">9</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.274</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.56</span>
</td></tr><tr style="height: 20px"><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">10</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.342</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.589</span>
</td></tr><tr><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  solid 0.5pt; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:#444444; font-family:Segoe UI; font-size:9pt">Average</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">4.29</span>
</td><td style="padding-left: 7px; padding-right: 7px; border-top:  none; border-left:  none; border-bottom:  solid 0.5pt; border-right:  solid 0.5pt">

<span style="color:black; font-size:9pt">6.58</span>
</td></tr></tbody></table></div>

<p>The calculation of π using C++ is 35% faster that it&#39;s corresponding C# code. This is to be expected. Many modern languages such as C# and Java run through a managed runtime. This brings MANY efficiencies to developers. However, the runtime tends to add overhead when it comes to performance. </p>
<p>The pragmatic folks reading this realize, that the benefits of a managed execution environment and modern language generally outweigh performance gains from a language like C++. There are reasons that C# and Java are used instead of C++ because developers can be more productive. Our example here, using a very slow numerical algorithm and running it for ten million iterations is a stretch for most scenarios. The 2.5 second difference for such an intensive calculation, while relatively large in our example, in the grand scheme of things is not that big of difference.</p>
<p>So why bring it up? It is important to think through performance more and more in today&#39;s computing environment for two reasons. The first is cost. As more and more organization move to utility based computing with hosted services, such as Amazon Web Services (AWS) and Azure, organization are paying for their compute cost. If you can realize performance gains that reduce CPU cycles that has a direct impact on the bottom line. The second reason is that mobile is taking over the world, and mobile users want more battery life, not less. Fewer CPU cycles on a smartphone or tablet will result in better battery life. </p>
<p>It will be very rare that most organizations would use C++ or other &quot;closer to the metal&quot; languages for their Line of Business (LOB) applications. The moral of the story though is for intensive processes in cloud hosted or mobile environments, you want to be razor focused on optimizing your code for performance, no matter what language you choose.</p>
<p>Both code examples are included, so for National Pi day, make a circle, calculate some π, eat some pie and enjoy!</p>
<p>C++</p>
<pre class="highlight"><code class="hljs cpp"><span class="hljs-comment">// LifeOfPi.cpp : Defines the entry point for the console application.</span>
<span class="hljs-comment">//</span>

<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> "stdafx.h"</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;iostream&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;iomanip&gt;</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-keyword">void</span> pi( <span class="hljs-keyword">double</span> *pi_value, <span class="hljs-keyword">int</span> *iterations);  

<span class="hljs-keyword">int</span> main ( <span class="hljs-keyword">void</span> )  
{  

      <span class="hljs-keyword">int</span> iterations = <span class="hljs-number">0</span>;     <span class="hljs-comment">// number of actual loop iterations in pi </span>
      <span class="hljs-keyword">double</span> pi_value = <span class="hljs-number">0</span>;    <span class="hljs-comment">// computed value of pi </span>

      clock_t cBegin = (<span class="hljs-keyword">double</span>)clock () ; 
      pi(&amp;pi_value, &amp;iterations);  
      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"   %0.15f with %d iterations\n"</span>,  pi_value, iterations);  
      clock_t cEnd = (<span class="hljs-keyword">double</span>) clock() ; 

      std::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-keyword">float</span>( cEnd - cBegin ) 

<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  

}    

<span class="hljs-keyword">void</span> pi( <span class="hljs-keyword">double</span> *pi_value, <span class="hljs-keyword">int</span> *iterations)  
{  
      <span class="hljs-keyword">int</span> i;  
      <span class="hljs-keyword">int</span> k=<span class="hljs-number">1</span>;
      <span class="hljs-keyword">double</span> realPi = <span class="hljs-number">3.141592653589793</span>; 
      <span class="hljs-keyword">double</span> epsilon = <span class="hljs-number">0.00000001</span>;
      <span class="hljs-keyword">double</span> delta=<span class="hljs-number">10</span>;
      *pi_value= <span class="hljs-number">0</span>;
      <span class="hljs-keyword">while</span> (delta&gt;epsilon) {
            *pi_value += <span class="hljs-built_in">pow</span>(-<span class="hljs-number">1</span>,(k+<span class="hljs-number">1</span>))/(<span class="hljs-number">2</span>*k-<span class="hljs-number">1</span>);
            delta = <span class="hljs-built_in">fabs</span>((<span class="hljs-number">4</span>* *pi_value)-realPi);
            k++;
      }
      *iterations = k;
      *pi_value = <span class="hljs-number">4</span> * *pi_value;

      <span class="hljs-keyword">return</span>; <span class="hljs-comment">// indicate program ended sucessfully </span>

} <span class="hljs-comment">// end fucntion main</span>
</code></pre>
<p>C#</p>
<pre class="highlight"><code class="hljs csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> System.Text;
<span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">LifeOfPiCSharp</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(<span class="hljs-keyword">string</span>[] args)</span>
        </span>{
            <span class="hljs-keyword">int</span> iterations = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">double</span> pi_value = <span class="hljs-number">0</span>;

            DateTime startTime = DateTime.Now;
            pi(<span class="hljs-keyword">out</span> pi_value,<span class="hljs-keyword">out</span> iterations);
            DateTime endTime = DateTime.Now;
            Console.WriteLine(pi_value.ToString() + <span class="hljs-string">" in "</span> + iterations);
            TimeSpan diff = endTime.Subtract(startTime);
            Console.WriteLine(diff.Seconds + <span class="hljs-string">"."</span>+diff.Milliseconds);
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pi</span><span class="hljs-params">(<span class="hljs-keyword">out</span> <span class="hljs-keyword">double</span> pi_value, <span class="hljs-keyword">out</span> <span class="hljs-keyword">int</span> totalIterations)</span>
        </span>{
            <span class="hljs-keyword">double</span> realPi = <span class="hljs-number">3.141592653589793</span>;
            <span class="hljs-keyword">double</span> epsilon = <span class="hljs-number">0.00000001</span>;
            <span class="hljs-keyword">double</span> delta = <span class="hljs-number">10</span>;
            <span class="hljs-keyword">int</span> k = <span class="hljs-number">1</span>;

            pi_value = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (delta &gt; epsilon)
            {
                pi_value += Math.Pow(-<span class="hljs-number">1</span>, (k + <span class="hljs-number">1</span>)) / (<span class="hljs-number">2</span> * k - <span class="hljs-number">1</span>);
                delta = Math.Abs((<span class="hljs-number">4</span> * pi_value) - realPi);
                k++;
            }
            totalIterations = k;
            pi_value = <span class="hljs-number">4</span> * pi_value;

        }
    }
}
</code></pre>
<p>&nbsp;</p>
<p>This blog post originally appeared at <a href="http://www.skylinetechnologies.com/Insights/Skyline-Blog/March-2013/Have-Your-Pi-and-Eat-it-Too-A-Comparison-of-C-an">Skyline Technologies</a></p>

    </div>

    
    <div class="post-tags">
        Posted In: <a href='/tags/ephemera/'>Ephemera</a>, <a href='/tags/pi/'>Pi</a>, <a href='/tags/skyline-technologies/'>Skyline Technologies</a>
    </div>
    
    <br/>
    Help improve this blog by submitting a <a href="https://github.com/jptacek/JPtacek.com/edit/master/src/documents/2013/03/have_your_pi/index.html.md">pull request.</a><br />

    <p>&nbsp;</p>

</article>
            <div id="me">
    <p>
        <img src="/images/Headshot-Square.png" alt="John Ptacek" />
        I'm <b>John Ptacek</b>, a software developer for <a href="http://www.SkylineTechnologies.com">Skyline Technologies</a>.
        This blog is my contains my content and opinions, which are not those of my employer.
    </p>
    <p>Currently, I am reading 
        <a href="https://www.goodreads.com/book/show/567704.Imajica">Imajica</a>
        by <a href="http://www.clivebarker.info">Clive Barker</a></p>
    <p>
        <a href="https://twitter.com/jptacek">@jptacek</a> &#8226;
        <a href="https://github.com/jptacek">GitHub</a> &#8226;
        <a href="https://www.linkedin.com/in/JohnPtacek/">LinkedIn</a> &#8226;
        <a href="https://stackoverflow.com/users/39797/john-ptacek">Stack Overflow</a> &#8226;
        <a href="https://plus.google.com/+JohnPtacek">Google+</a>
    </p>
</div>

            <div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript></div>
<script type="text/javascript">
    var disqus_shortname = 'jptacek';
    var disqus_url = 'http://www.jptacek.com/2013/03/have_your_pi/';
    var disqus_identifier = disqus_url;
    var disqus_title = 'Have Your Pi and Eat it Too: A Comparison of C# and C++ Performance';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

</div>

<div class="container">
    <div class="navbar navbar-footer">
        <p class="navbar-center navbar-text">Content copyright &copy; 2016 John Ptacek</p>
    </div>
</div>



    <script type="text/javascript" src="/vendor/angular/angular.min.js"></script>
    <script type="text/javascript" src="/vendor/angular-route/angular-route.min.js"></script>
    <script type="text/javascript" src="/vendor/angular-animate/angular-animate.min.js"></script>

 

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="/scripts/site.js"></script>



    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34910017-1']);
    _gaq.push(['_setDomainName', 'jptacek.com']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

</body>
</html>
